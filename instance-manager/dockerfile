FROM python:3.8-slim

# Install dependencies
RUN apt-get update && apt-get install -y \
    libffi-dev \
    libssl-dev \
    gcc \
    libc-dev \
    make \
    curl \
    && apt-get clean

# Install kubectl
RUN curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
RUN chmod +x ./kubectl
RUN mv ./kubectl /usr/local/bin

# Verify kubectl installation
RUN which kubectl

# Copy application files
COPY requirements.txt /app/requirements.txt

# Install Python packages
RUN pip install --no-cache-dir -r /app/requirements.txt

# Copy the application code
COPY . /app

WORKDIR /app

# Run the application
CMD ["gunicorn", "-b", "0.0.0.0:8000", "app:app", "--worker-class", "eventlet", "--workers", "1"]
